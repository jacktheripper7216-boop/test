<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Inventory Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #5a6fd6;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .toggle-form {
            text-align: center;
            margin-top: 20px;
        }

        .toggle-form a {
            color: #667eea;
            cursor: pointer;
            text-decoration: none;
        }

        .toggle-form a:hover {
            text-decoration: underline;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .navbar {
            background: #333;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h2 {
            font-size: 20px;
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 60px;
            width: 220px;
            height: calc(100vh - 60px);
            background: #2c3e50;
            padding: 20px 0;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            padding: 12px 20px;
            cursor: pointer;
            color: #bdc3c7;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu li:hover,
        .sidebar-menu li.active {
            background: #34495e;
            color: white;
            border-left-color: #667eea;
        }

        .main-content {
            margin-left: 220px;
            padding: 20px;
            min-height: calc(100vh - 60px);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-header h3 {
            font-size: 24px;
            color: #333;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-card h4 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 20px;
        }

        .modal-close {
            cursor: pointer;
            font-size: 24px;
            color: #666;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Alert */
        .alert {
            padding: 12px 20px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login/Register Page -->
    <div id="auth-page" class="login-container">
        <div class="login-box">
            <h1>Smart Inventory</h1>

            <div id="alert-container"></div>

            <!-- Login Form -->
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="hidden">
                <div class="form-group">
                    <label for="register-username">Username</label>
                    <input type="text" id="register-username" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-fullname">Full Name</label>
                    <input type="text" id="register-fullname" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" required>
                </div>
                <button type="submit" class="btn btn-primary">Register</button>
            </form>

            <div class="toggle-form">
                <span id="toggle-to-register">Don't have an account? <a>Register</a></span>
                <span id="toggle-to-login" class="hidden">Already have an account? <a>Login</a></span>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <nav class="navbar">
            <h2>Smart Inventory Management</h2>
            <div class="navbar-user">
                <span id="user-display"></span>
                <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
            </div>
        </nav>

        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li class="active" data-page="home">Dashboard</li>
                <li data-page="products">Products</li>
                <li data-page="categories">Categories</li>
                <li data-page="suppliers">Suppliers</li>
                <li data-page="stocks">Stocks</li>
                <li data-page="clients">Clients</li>
            </ul>
        </aside>

        <main class="main-content">
            <!-- Dashboard Home -->
            <div id="page-home" class="page active">
                <div class="page-header">
                    <h3>Dashboard</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Total Products</h4>
                        <div class="value" id="stat-products">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Total Categories</h4>
                        <div class="value" id="stat-categories">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Total Suppliers</h4>
                        <div class="value" id="stat-suppliers">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Total Stocks</h4>
                        <div class="value" id="stat-stocks">0</div>
                    </div>
                </div>
                <div class="card">
                    <h4 class="card-title">Welcome to Smart Inventory Management</h4>
                    <p>Use the sidebar to navigate between different sections and manage your inventory.</p>
                </div>
            </div>

            <!-- Products Page -->
            <div id="page-products" class="page">
                <div class="page-header">
                    <h3>Products</h3>
                    <button class="btn btn-success" onclick="openModal('product')">Add Product</button>
                </div>
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Brand</th>
                                    <th>Category</th>
                                    <th>Warranty (months)</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="products-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Categories Page -->
            <div id="page-categories" class="page">
                <div class="page-header">
                    <h3>Categories</h3>
                    <button class="btn btn-success" onclick="openModal('category')">Add Category</button>
                </div>
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="categories-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Suppliers Page -->
            <div id="page-suppliers" class="page">
                <div class="page-header">
                    <h3>Suppliers</h3>
                    <button class="btn btn-success" onclick="openModal('supplier')">Add Supplier</button>
                </div>
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Contact</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="suppliers-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Stocks Page -->
            <div id="page-stocks" class="page">
                <div class="page-header">
                    <h3>Stocks</h3>
                    <button class="btn btn-success" onclick="openModal('stock')">Add Stock</button>
                </div>
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Product</th>
                                    <th>Supplier</th>
                                    <th>Quantity</th>
                                    <th>Cost Price</th>
                                    <th>Selling Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="stocks-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Clients Page -->
            <div id="page-clients" class="page">
                <div class="page-header">
                    <h3>Clients</h3>
                    <button class="btn btn-success" onclick="openModal('client')">Add Client</button>
                </div>
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Credit Client</th>
                                    <th>Credit Limit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clients-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">Add Product</h3>
                <span class="modal-close" onclick="closeModal('product')">&times;</span>
            </div>
            <form id="product-form">
                <input type="hidden" id="product-id">
                <div class="form-group">
                    <label for="product-name">Name *</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label for="product-brand">Brand</label>
                    <input type="text" id="product-brand">
                </div>
                <div class="form-group">
                    <label for="product-description">Description</label>
                    <input type="text" id="product-description">
                </div>
                <div class="form-group">
                    <label for="product-warranty">Warranty (months)</label>
                    <input type="number" id="product-warranty">
                </div>
                <div class="form-group">
                    <label for="product-category">Category *</label>
                    <select id="product-category" required></select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('product')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="category-modal-title">Add Category</h3>
                <span class="modal-close" onclick="closeModal('category')">&times;</span>
            </div>
            <form id="category-form">
                <input type="hidden" id="category-id">
                <div class="form-group">
                    <label for="category-name">Name *</label>
                    <input type="text" id="category-name" required>
                </div>
                <div class="form-group">
                    <label for="category-description">Description</label>
                    <input type="text" id="category-description">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('category')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplier-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="supplier-modal-title">Add Supplier</h3>
                <span class="modal-close" onclick="closeModal('supplier')">&times;</span>
            </div>
            <form id="supplier-form">
                <input type="hidden" id="supplier-id">
                <div class="form-group">
                    <label for="supplier-name">Name *</label>
                    <input type="text" id="supplier-name" required>
                </div>
                <div class="form-group">
                    <label for="supplier-contact">Contact Person</label>
                    <input type="text" id="supplier-contact">
                </div>
                <div class="form-group">
                    <label for="supplier-email">Email</label>
                    <input type="email" id="supplier-email">
                </div>
                <div class="form-group">
                    <label for="supplier-phone">Phone</label>
                    <input type="text" id="supplier-phone">
                </div>
                <div class="form-group">
                    <label for="supplier-address">Address</label>
                    <input type="text" id="supplier-address">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('supplier')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stock Modal -->
    <div id="stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="stock-modal-title">Add Stock</h3>
                <span class="modal-close" onclick="closeModal('stock')">&times;</span>
            </div>
            <form id="stock-form">
                <input type="hidden" id="stock-id">
                <div class="form-group">
                    <label for="stock-product">Product *</label>
                    <select id="stock-product" required></select>
                </div>
                <div class="form-group">
                    <label for="stock-supplier">Supplier *</label>
                    <select id="stock-supplier" required></select>
                </div>
                <div class="form-group">
                    <label for="stock-quantity">Quantity *</label>
                    <input type="number" id="stock-quantity" required min="0">
                </div>
                <div class="form-group">
                    <label for="stock-cost">Cost Price *</label>
                    <input type="number" id="stock-cost" required step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="stock-selling">Selling Price *</label>
                    <input type="number" id="stock-selling" required step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="stock-reorder">Reorder Level</label>
                    <input type="number" id="stock-reorder" min="0">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('stock')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="client-modal-title">Add Client</h3>
                <span class="modal-close" onclick="closeModal('client')">&times;</span>
            </div>
            <form id="client-form">
                <input type="hidden" id="client-id">
                <div class="form-group">
                    <label for="client-name">Name *</label>
                    <input type="text" id="client-name" required>
                </div>
                <div class="form-group">
                    <label for="client-email">Email</label>
                    <input type="email" id="client-email">
                </div>
                <div class="form-group">
                    <label for="client-phone">Phone</label>
                    <input type="text" id="client-phone">
                </div>
                <div class="form-group">
                    <label for="client-address">Address</label>
                    <input type="text" id="client-address">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="client-credit"> Is Credit Client
                    </label>
                </div>
                <div class="form-group">
                    <label for="client-limit">Credit Limit</label>
                    <input type="number" id="client-limit" step="0.01" min="0">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('client')">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = '/api';
        let currentUser = null;

        // Utility functions
        function showAlert(message, type = 'info') {
            const container = document.getElementById('alert-container');
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (data) {
                options.body = JSON.stringify(data);
            }
            const response = await fetch(`${API_URL}${endpoint}`, options);
            const result = await response.json().catch(() => ({}));
            if (!response.ok) {
                throw new Error(result.message || 'An error occurred');
            }
            return result;
        }

        // Auth functions
        document.getElementById('toggle-to-register').addEventListener('click', () => {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
            document.getElementById('toggle-to-register').classList.add('hidden');
            document.getElementById('toggle-to-login').classList.remove('hidden');
        });

        document.getElementById('toggle-to-login').addEventListener('click', () => {
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('toggle-to-login').classList.add('hidden');
            document.getElementById('toggle-to-register').classList.remove('hidden');
        });

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            try {
                const result = await apiCall('/login', 'POST', { username, password });
                currentUser = result.user;
                localStorage.setItem('user', JSON.stringify(currentUser));
                showDashboard();
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        });

        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                username: document.getElementById('register-username').value,
                email: document.getElementById('register-email').value,
                full_name: document.getElementById('register-fullname').value,
                password: document.getElementById('register-password').value
            };

            try {
                await apiCall('/register', 'POST', data);
                showAlert('Registration successful! Please login.', 'success');
                document.getElementById('toggle-to-login').click();
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        });

        function logout() {
            currentUser = null;
            localStorage.removeItem('user');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('auth-page').style.display = 'flex';
        }

        function showDashboard() {
            document.getElementById('auth-page').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('user-display').textContent = currentUser?.username || 'User';
            loadStats();
            loadProducts();
            loadCategories();
            loadSuppliers();
            loadStocks();
            loadClients();
        }

        // Navigation
        document.querySelectorAll('.sidebar-menu li').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.sidebar-menu li').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                item.classList.add('active');
                document.getElementById(`page-${item.dataset.page}`).classList.add('active');
            });
        });

        // Dashboard stats
        async function loadStats() {
            try {
                const [products, categories, suppliers, stocks] = await Promise.all([
                    apiCall('/products'),
                    apiCall('/categories'),
                    apiCall('/suppliers'),
                    apiCall('/stocks')
                ]);
                document.getElementById('stat-products').textContent = products.length;
                document.getElementById('stat-categories').textContent = categories.length;
                document.getElementById('stat-suppliers').textContent = suppliers.length;
                document.getElementById('stat-stocks').textContent = stocks.length;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Products
        let productsData = [];
        let categoriesData = [];

        async function loadProducts() {
            try {
                productsData = await apiCall('/products');
                renderProducts();
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function renderProducts() {
            const tbody = document.getElementById('products-table');
            if (productsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No products found</td></tr>';
                return;
            }
            tbody.innerHTML = productsData.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.name}</td>
                    <td>${p.brand || '-'}</td>
                    <td>${p.categoryName || '-'}</td>
                    <td>${p.warrantyMonths || '-'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editProduct(${p.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteProduct(${p.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function editProduct(id) {
            const product = productsData.find(p => p.id === id);
            if (product) {
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-brand').value = product.brand || '';
                document.getElementById('product-description').value = product.description || '';
                document.getElementById('product-warranty').value = product.warrantyMonths || '';
                document.getElementById('product-category').value = product.categoryId || '';
                document.getElementById('product-modal-title').textContent = 'Edit Product';
                openModal('product');
            }
        }

        async function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    await apiCall(`/products/${id}`, 'DELETE');
                    loadProducts();
                    loadStats();
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('product-id').value;
            const data = {
                name: document.getElementById('product-name').value,
                brand: document.getElementById('product-brand').value,
                description: document.getElementById('product-description').value,
                warranty_months: document.getElementById('product-warranty').value || null,
                category_id: document.getElementById('product-category').value
            };

            try {
                if (id) {
                    await apiCall(`/products/${id}`, 'PUT', data);
                } else {
                    await apiCall('/products', 'POST', data);
                }
                closeModal('product');
                loadProducts();
                loadStats();
            } catch (error) {
                alert(error.message);
            }
        });

        // Categories
        async function loadCategories() {
            try {
                categoriesData = await apiCall('/categories');
                renderCategories();
                updateCategorySelects();
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function renderCategories() {
            const tbody = document.getElementById('categories-table');
            if (categoriesData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">No categories found</td></tr>';
                return;
            }
            tbody.innerHTML = categoriesData.map(c => `
                <tr>
                    <td>${c.id}</td>
                    <td>${c.name}</td>
                    <td>${c.description || '-'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editCategory(${c.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCategory(${c.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateCategorySelects() {
            const select = document.getElementById('product-category');
            select.innerHTML = '<option value="">Select Category</option>' +
                categoriesData.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        async function editCategory(id) {
            const category = categoriesData.find(c => c.id === id);
            if (category) {
                document.getElementById('category-id').value = category.id;
                document.getElementById('category-name').value = category.name;
                document.getElementById('category-description').value = category.description || '';
                document.getElementById('category-modal-title').textContent = 'Edit Category';
                openModal('category');
            }
        }

        async function deleteCategory(id) {
            if (confirm('Are you sure you want to delete this category?')) {
                try {
                    await apiCall(`/categories/${id}`, 'DELETE');
                    loadCategories();
                    loadStats();
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        document.getElementById('category-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('category-id').value;
            const data = {
                name: document.getElementById('category-name').value,
                description: document.getElementById('category-description').value
            };

            try {
                if (id) {
                    await apiCall(`/categories/${id}`, 'PUT', data);
                } else {
                    await apiCall('/categories', 'POST', data);
                }
                closeModal('category');
                loadCategories();
                loadStats();
            } catch (error) {
                alert(error.message);
            }
        });

        // Suppliers
        let suppliersData = [];

        async function loadSuppliers() {
            try {
                suppliersData = await apiCall('/suppliers');
                renderSuppliers();
                updateSupplierSelects();
            } catch (error) {
                console.error('Error loading suppliers:', error);
            }
        }

        function renderSuppliers() {
            const tbody = document.getElementById('suppliers-table');
            if (suppliersData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No suppliers found</td></tr>';
                return;
            }
            tbody.innerHTML = suppliersData.map(s => `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.contactPerson || '-'}</td>
                    <td>${s.contactEmail || '-'}</td>
                    <td>${s.contactPhone || '-'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editSupplier(${s.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSupplier(${s.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateSupplierSelects() {
            const select = document.getElementById('stock-supplier');
            select.innerHTML = '<option value="">Select Supplier</option>' +
                suppliersData.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }

        async function editSupplier(id) {
            const supplier = suppliersData.find(s => s.id === id);
            if (supplier) {
                document.getElementById('supplier-id').value = supplier.id;
                document.getElementById('supplier-name').value = supplier.name;
                document.getElementById('supplier-contact').value = supplier.contactPerson || '';
                document.getElementById('supplier-email').value = supplier.contactEmail || '';
                document.getElementById('supplier-phone').value = supplier.contactPhone || '';
                document.getElementById('supplier-address').value = supplier.address || '';
                document.getElementById('supplier-modal-title').textContent = 'Edit Supplier';
                openModal('supplier');
            }
        }

        async function deleteSupplier(id) {
            if (confirm('Are you sure you want to delete this supplier?')) {
                try {
                    await apiCall(`/suppliers/${id}`, 'DELETE');
                    loadSuppliers();
                    loadStats();
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        document.getElementById('supplier-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('supplier-id').value;
            const data = {
                name: document.getElementById('supplier-name').value,
                contact_person: document.getElementById('supplier-contact').value,
                contact_email: document.getElementById('supplier-email').value,
                contact_phone: document.getElementById('supplier-phone').value,
                address: document.getElementById('supplier-address').value
            };

            try {
                if (id) {
                    await apiCall(`/suppliers/${id}`, 'PUT', data);
                } else {
                    await apiCall('/suppliers', 'POST', data);
                }
                closeModal('supplier');
                loadSuppliers();
                loadStats();
            } catch (error) {
                alert(error.message);
            }
        });

        // Stocks
        let stocksData = [];

        async function loadStocks() {
            try {
                stocksData = await apiCall('/stocks');
                renderStocks();
                updateProductSelects();
            } catch (error) {
                console.error('Error loading stocks:', error);
            }
        }

        function renderStocks() {
            const tbody = document.getElementById('stocks-table');
            if (stocksData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No stocks found</td></tr>';
                return;
            }
            tbody.innerHTML = stocksData.map(s => `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.productName || '-'}</td>
                    <td>${s.supplierName || '-'}</td>
                    <td>${s.quantityInStock}</td>
                    <td>$${s.costPrice?.toFixed(2) || '0.00'}</td>
                    <td>$${s.sellingPrice?.toFixed(2) || '0.00'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editStock(${s.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteStock(${s.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateProductSelects() {
            const select = document.getElementById('stock-product');
            select.innerHTML = '<option value="">Select Product</option>' +
                productsData.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        async function editStock(id) {
            const stock = stocksData.find(s => s.id === id);
            if (stock) {
                document.getElementById('stock-id').value = stock.id;
                document.getElementById('stock-product').value = stock.productId || '';
                document.getElementById('stock-supplier').value = stock.supplierId || '';
                document.getElementById('stock-quantity').value = stock.quantityInStock || 0;
                document.getElementById('stock-cost').value = stock.costPrice || '';
                document.getElementById('stock-selling').value = stock.sellingPrice || '';
                document.getElementById('stock-reorder').value = stock.reorderLevel || '';
                document.getElementById('stock-modal-title').textContent = 'Edit Stock';
                openModal('stock');
            }
        }

        async function deleteStock(id) {
            if (confirm('Are you sure you want to delete this stock?')) {
                try {
                    await apiCall(`/stocks/${id}`, 'DELETE');
                    loadStocks();
                    loadStats();
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        document.getElementById('stock-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('stock-id').value;
            const data = {
                product_id: document.getElementById('stock-product').value,
                supplier_id: document.getElementById('stock-supplier').value,
                quantity_in_stock: document.getElementById('stock-quantity').value,
                cost_price: document.getElementById('stock-cost').value,
                selling_price: document.getElementById('stock-selling').value,
                reorder_level: document.getElementById('stock-reorder').value || null
            };

            try {
                if (id) {
                    await apiCall(`/stocks/${id}`, 'PUT', data);
                } else {
                    await apiCall('/stocks', 'POST', data);
                }
                closeModal('stock');
                loadStocks();
                loadStats();
            } catch (error) {
                alert(error.message);
            }
        });

        // Clients
        let clientsData = [];

        async function loadClients() {
            try {
                clientsData = await apiCall('/clients');
                renderClients();
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }

        function renderClients() {
            const tbody = document.getElementById('clients-table');
            if (clientsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No clients found</td></tr>';
                return;
            }
            tbody.innerHTML = clientsData.map(c => `
                <tr>
                    <td>${c.id}</td>
                    <td>${c.name}</td>
                    <td>${c.contactEmail || '-'}</td>
                    <td>${c.contactPhone || '-'}</td>
                    <td>${c.isCreditClient ? 'Yes' : 'No'}</td>
                    <td>${c.creditLimit ? '$' + c.creditLimit.toFixed(2) : '-'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editClient(${c.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteClient(${c.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function editClient(id) {
            const client = clientsData.find(c => c.id === id);
            if (client) {
                document.getElementById('client-id').value = client.id;
                document.getElementById('client-name').value = client.name;
                document.getElementById('client-email').value = client.contactEmail || '';
                document.getElementById('client-phone').value = client.contactPhone || '';
                document.getElementById('client-address').value = client.address || '';
                document.getElementById('client-credit').checked = client.isCreditClient || false;
                document.getElementById('client-limit').value = client.creditLimit || '';
                document.getElementById('client-modal-title').textContent = 'Edit Client';
                openModal('client');
            }
        }

        async function deleteClient(id) {
            if (confirm('Are you sure you want to delete this client?')) {
                try {
                    await apiCall(`/clients/${id}`, 'DELETE');
                    loadClients();
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        document.getElementById('client-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('client-id').value;
            const data = {
                name: document.getElementById('client-name').value,
                contact_email: document.getElementById('client-email').value,
                contact_phone: document.getElementById('client-phone').value,
                address: document.getElementById('client-address').value,
                is_credit_client: document.getElementById('client-credit').checked,
                credit_limit: document.getElementById('client-limit').value || null
            };

            try {
                if (id) {
                    await apiCall(`/clients/${id}`, 'PUT', data);
                } else {
                    await apiCall('/clients', 'POST', data);
                }
                closeModal('client');
                loadClients();
            } catch (error) {
                alert(error.message);
            }
        });

        // Modal functions
        function openModal(type) {
            document.getElementById(`${type}-modal`).classList.add('active');
        }

        function closeModal(type) {
            document.getElementById(`${type}-modal`).classList.remove('active');
            document.getElementById(`${type}-form`).reset();
            document.getElementById(`${type}-id`).value = '';
            document.getElementById(`${type}-modal-title`).textContent = `Add ${type.charAt(0).toUpperCase() + type.slice(1)}`;
        }

        // Initialize
        window.onload = function() {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            }
        };
    </script>
</body>
</html>
